---
- hosts: hqswitch
  gather_facts: yes

  vars:
    backuppath: "/home/awx/swbackup"


  tasks:
    - name: Create backup dir
      file:
        path: "{{ backuppath }}"
        state: directory
        recurse: yes


    - name: Backup switch (ios)
      ios_config:
        backup: yes
      register: backup_location
      copy:
       src: "{{ backup_location.shortname }}"
       dest: "/{{ backuppath }}/{{ ansible_host }}.cfg"
      when: ansible_network_os == 'ios'
